<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>example 1 · ParameterSpacePartitions</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ParameterSpacePartitions</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>example 1</a><ul class="internal"><li><a class="tocitem" href="#Load-Dependencies"><span>Load Dependencies</span></a></li><li><a class="tocitem" href="#Model-Function"><span>Model Function</span></a></li><li><a class="tocitem" href="#Pattern-Function"><span>Pattern Function</span></a></li><li><a class="tocitem" href="#Model-Configuration"><span>Model Configuration</span></a></li><li class="toplevel"><a class="tocitem" href="#Boundaries"><span>Boundaries</span></a></li><li><a class="tocitem" href="#Starting-Points"><span>Starting Points</span></a></li><li><a class="tocitem" href="#Option-Configuration"><span>Option Configuration</span></a></li><li><a class="tocitem" href="#Find-Partitions"><span>Find Partitions</span></a></li><li><a class="tocitem" href="#Results"><span>Results</span></a></li><li><a class="tocitem" href="#Volume-Estimation"><span>Volume Estimation</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../api/">api</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">examples</a></li><li class="is-active"><a href>example 1</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>example 1</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/itsdfish/ParameterSpacePartitions.jl/blob/master/docs/src/example1.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h1><p>In this simple example, parameter space partitioning is applied to a cube with regions of equal volume.</p><h2 id="Load-Dependencies"><a class="docs-heading-anchor" href="#Load-Dependencies">Load Dependencies</a><a id="Load-Dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Load-Dependencies" title="Permalink"></a></h2><p>The first step is to the load dependences into your session.</p><pre><code class="language-julia hljs">using Distributions
using ParameterSpacePartitions
using ParameterSpacePartitions.TestModels
using Random
using DataFrames
Random.seed!(544)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Random.TaskLocalRNG()</code></pre><h2 id="Model-Function"><a class="docs-heading-anchor" href="#Model-Function">Model Function</a><a id="Model-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Function" title="Permalink"></a></h2><p>Next, we define a model that accepts a vector of parameters and returns data predictions. The function <code>model</code> is imported above from <code>TestModels</code>, but is presented below for illustration. In this simple example, the model returns the parameter inputs. In more substantive model, the returned value will be the model predictions.</p><pre><code class="language-julia hljs">model(parms, args...; kwargs...) = parms</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">model (generic function with 1 method)</code></pre><h2 id="Pattern-Function"><a class="docs-heading-anchor" href="#Pattern-Function">Pattern Function</a><a id="Pattern-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Pattern-Function" title="Permalink"></a></h2><p>A second function categorizes the predicted data into a qualitative pattern. At minimum, the pattern function must recieve a data input. In this example, the pattern function <code>p_fun</code> is imported from <code>TestModels</code>. The function is presented below for illustration. <code>p_fun</code> requires the location (i.e. parameters) and <code>HyperCube</code> object, which contains  partition boundaries (which is the same for each dimension). <code>p_fun</code> categorizes <code>location</code> on each dimension and returns a vector representing a pattern. For example, the pattern <code>[1,2,1]</code> indicates the <code>location</code> is in the partition for which the x axis is 1, the y axis is 2, and the z axis is 1. </p><pre><code class="language-julia hljs">function p_fun(location, hypercube::HyperCube, args...; kwargs...)
    p_bounds = hypercube.p_bounds
    nb = length(p_bounds)
    nd = length(location)
    vals = fill(-100, nd)
    for j in 1:nd
        for i in 1:(nb-1)
            if (location[j] ≥ p_bounds[i]) &amp;&amp; (location[j] ≤ p_bounds[i+1])
                vals[j] = i
                continue
            end
        end
    end
    return vals
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">p_fun (generic function with 1 method)</code></pre><h2 id="Model-Configuration"><a class="docs-heading-anchor" href="#Model-Configuration">Model Configuration</a><a id="Model-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Configuration" title="Permalink"></a></h2><p>Below, we will set <code>n_dims</code> and <code>n_part</code> to create a cube with a total of 2^3 = 8 regions.</p><pre><code class="language-julia hljs"># dimensions of the hypbercue
n_dims = 3
# partitions per dimension
n_part = 2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2</code></pre><h1 id="Boundaries"><a class="docs-heading-anchor" href="#Boundaries">Boundaries</a><a id="Boundaries-1"></a><a class="docs-heading-anchor-permalink" href="#Boundaries" title="Permalink"></a></h1><p>In the code below, <code>bounds</code> contains the upper and lower boundaries for each dimension. In addition, we must also define a <code>HyperCube</code> object containing the boundaries for each partition. The boundaries are stored in a variable called <code>p_bounds</code>.  In this example, the partitions are equally spaced along each dimension of the unit cube. Alternatively, we could use unequal spacing to increase the difficulty of exploring the parameter space.</p><pre><code class="language-julia hljs"># partition boundaries
bounds = fill((0, 1), n_dims)
p_bounds = range(0, 1, n_part + 1)
hypercube = HyperCube(p_bounds)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ParameterSpacePartitions.TestModels.HyperCube([0.0, 0.5, 1.0])</code></pre><h2 id="Starting-Points"><a class="docs-heading-anchor" href="#Starting-Points">Starting Points</a><a id="Starting-Points-1"></a><a class="docs-heading-anchor-permalink" href="#Starting-Points" title="Permalink"></a></h2><p>The sampling algorim requires a starting point to begin exploring the parameter space. The starting points must be wrapped in a vector. The starting points are sampled uniformly within the unit cube, using <code>bounds</code> to ensure the starting point is within allowable ranges. Although one starting point is sufficient for the present example, seeding the sampling algorithm with multiple starting points can improve performance. </p><pre><code class="language-julia hljs"># number of starting points
n_start = 1
# sample function
sample(bounds) = map(b -&gt; rand(Uniform(b...)), bounds)
# initial starting points
init_parms = map(_ -&gt; sample(bounds), 1:n_start)
parm_names = [:p1,:p2,:p3]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Symbol}:
 :p1
 :p2
 :p3</code></pre><h2 id="Option-Configuration"><a class="docs-heading-anchor" href="#Option-Configuration">Option Configuration</a><a id="Option-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Option-Configuration" title="Permalink"></a></h2><p>We can configure options to define and improve the performance of the algorithm. The search radius is an important configuration. The challenge is to balance the tradeoff between exploration and exploitation. If the radius is too small, it will stay in one region (or a sub-space of a region), and will fail to find new regions. By contrast, if the radius is too large, many regions will be found, but will not be well defined. Pitt et al. noted that an acceptance rate of 20% may work well in many cases, but this is a heuristic rather than a hard requirement. The options also stores the bounds and initial parameters. Threading can be enabled by setting <code>parallel=true</code>. Some exploration revealed that threading becomes advantageous once the evaluation time reaches 1 millisecond or longer. Otherwise, threading overhead will reduce the speed of the algorithm. </p><pre><code class="language-julia hljs">options = Options(;
    radius = .10,
    bounds,
    n_iters = 1000,
    init_parms
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Options{Bool, Float64, Vector{Tuple{Int64, Int64}}, Vector{Int64}, Int64, typeof(ParameterSpacePartitions.eval_patterns), ParameterSpacePartitions.var&quot;#14#16&quot;{typeof(adapt!), Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}}}, Vector{Vector{Float64}}, Int64, Vector{Symbol}, Int64, Int64}(false, 0.1, [(0, 1), (0, 1), (0, 1)], [1, 1, 1], 1000, ParameterSpacePartitions.eval_patterns, ParameterSpacePartitions.var&quot;#14#16&quot;{typeof(adapt!), Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}}}(ParameterSpacePartitions.adapt!, Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}}()), [[0.30380893217827787, 0.2383018801670267, 0.12387181523971857]], 3, [:p1, :p2, :p3], 0, 0)</code></pre><p>It is also possible to pass a custom adaption function via the keyword <code>adapt_radius!</code>. By default, the adaption function adjusts the radius to achieve a 40% acceptance rate. Additional information for configuring the default adaption function can be found via the help feature:</p><pre><code class="language-julia hljs">? adapt!</code></pre><h2 id="Find-Partitions"><a class="docs-heading-anchor" href="#Find-Partitions">Find Partitions</a><a id="Find-Partitions-1"></a><a class="docs-heading-anchor-permalink" href="#Find-Partitions" title="Permalink"></a></h2><p>Now that the requisite functions and options have been specified, we can now explore the parameter space. The function <code>find_partitions</code> accepts the <code>model</code> function, the pattern function <code>p_fun</code>, the options object, and additional arguments and keyword arguments for <code>p_fun</code>.</p><pre><code class="language-julia hljs">results = find_partitions(
    model,
    p_fun,
    options,
    hypercube,
)
first(results)</code></pre><div><div style = "float: left;"><span>DataFrameRow (7 columns)</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">chain_id</th><th style = "text-align: left;">pattern</th><th style = "text-align: left;">p1</th><th style = "text-align: left;">p2</th><th style = "text-align: left;">p3</th><th style = "text-align: left;">acceptance</th><th style = "text-align: left;">radius</th></tr><tr class = "subheader headerLastRow"><th class = "rowLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Vector{Int64}" style = "text-align: left;">Array…</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Bool" style = "text-align: left;">Bool</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">3</td><td style = "text-align: left;">[1, 2, 2]</td><td style = "text-align: right;">0.387997</td><td style = "text-align: right;">0.540261</td><td style = "text-align: right;">0.544291</td><td style = "text-align: right;">true</td><td style = "text-align: right;">0.1</td></tr></tbody></table></div><p><code>results</code> is a vector of <code>Results</code> objects containing the following information:</p><ul><li><code>iter</code>: the iteration of the algorithm</li><li><code>chain_id</code>: an index of the chain, i.e. 2 is the second chain</li><li><code>parms</code>: a vector of parameters</li><li><code>pattern</code>: the target pattern of the chain</li><li><code>acceptance</code>: a vector indicating whether a proposal was accepted. If accepted, <code>parms</code> is the accepted proposal. If not accepted, <code>parms</code> is the same as the previous iteration.</li></ul><h2 id="Results"><a class="docs-heading-anchor" href="#Results">Results</a><a id="Results-1"></a><a class="docs-heading-anchor-permalink" href="#Results" title="Permalink"></a></h2><p>The next code block finds the minimum and maximum of each partition.</p><pre><code class="language-julia hljs">df = DataFrame(results)
groups = groupby(df, :pattern)
summary = combine(groups,
    :p1 =&gt; minimum, :p1 =&gt; maximum,
    :p2 =&gt; minimum, :p2 =&gt; maximum,
    :p3 =&gt; minimum, :p3 =&gt; maximum
) |&gt; sort</code></pre><div><div style = "float: left;"><span>8×7 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">pattern</th><th style = "text-align: left;">p1_minimum</th><th style = "text-align: left;">p1_maximum</th><th style = "text-align: left;">p2_minimum</th><th style = "text-align: left;">p2_maximum</th><th style = "text-align: left;">p3_minimum</th><th style = "text-align: left;">p3_maximum</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Vector{Int64}" style = "text-align: left;">Array…</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">[1, 1, 1]</td><td style = "text-align: right;">0.000328433</td><td style = "text-align: right;">0.499494</td><td style = "text-align: right;">0.000398249</td><td style = "text-align: right;">0.499869</td><td style = "text-align: right;">0.00316608</td><td style = "text-align: right;">0.499197</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">[1, 1, 2]</td><td style = "text-align: right;">0.00724318</td><td style = "text-align: right;">0.499225</td><td style = "text-align: right;">0.00126221</td><td style = "text-align: right;">0.499246</td><td style = "text-align: right;">0.500418</td><td style = "text-align: right;">0.999058</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">[1, 2, 1]</td><td style = "text-align: right;">0.000643857</td><td style = "text-align: right;">0.499773</td><td style = "text-align: right;">0.501071</td><td style = "text-align: right;">0.999353</td><td style = "text-align: right;">0.000408015</td><td style = "text-align: right;">0.499862</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">[1, 2, 2]</td><td style = "text-align: right;">0.00107225</td><td style = "text-align: right;">0.499707</td><td style = "text-align: right;">0.500181</td><td style = "text-align: right;">0.997551</td><td style = "text-align: right;">0.500511</td><td style = "text-align: right;">0.999968</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">[2, 1, 1]</td><td style = "text-align: right;">0.501703</td><td style = "text-align: right;">0.996742</td><td style = "text-align: right;">0.00484655</td><td style = "text-align: right;">0.499582</td><td style = "text-align: right;">8.36059e-5</td><td style = "text-align: right;">0.499978</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">[2, 1, 2]</td><td style = "text-align: right;">0.501122</td><td style = "text-align: right;">0.999319</td><td style = "text-align: right;">0.000114055</td><td style = "text-align: right;">0.499156</td><td style = "text-align: right;">0.500959</td><td style = "text-align: right;">0.997596</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">[2, 2, 1]</td><td style = "text-align: right;">0.500822</td><td style = "text-align: right;">0.999124</td><td style = "text-align: right;">0.50094</td><td style = "text-align: right;">0.999829</td><td style = "text-align: right;">2.6546e-5</td><td style = "text-align: right;">0.499569</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">[2, 2, 2]</td><td style = "text-align: right;">0.504304</td><td style = "text-align: right;">0.999564</td><td style = "text-align: right;">0.501617</td><td style = "text-align: right;">0.998069</td><td style = "text-align: right;">0.500387</td><td style = "text-align: right;">0.999823</td></tr></tbody></table></div><h2 id="Volume-Estimation"><a class="docs-heading-anchor" href="#Volume-Estimation">Volume Estimation</a><a id="Volume-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Volume-Estimation" title="Permalink"></a></h2><p>The function <code>estimate_volume</code> approximates the volume of each region using an ellipsoid based on the covariance of sampled points in the region. As expected, the volume percentage estimates are close to 1/8 = .125.</p><pre><code class="language-julia hljs">groups = groupby(df, :pattern)

df_volume = combine(
    groups,
    x -&gt; estimate_volume(
        model,
        p_fun,
        x,
        bounds,
        hypercube;
        parm_names,
    )
)

df_volume.volume = df_volume.x1 / sum(df_volume.x1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Float64}:
 0.12445824483220003
 0.12672956237345967
 0.1250359295395628
 0.12328719494749203
 0.12374104422289106
 0.12469657572233146
 0.13307144291329803
 0.11898000544876494</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« home</a><a class="docs-footer-nextpage" href="../api/">api »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 10 September 2023 11:39">Sunday 10 September 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
